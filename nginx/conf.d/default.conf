# 1. HTTP (80) ì„œë²„: HTTPSë¡œ ë¦¬ë””ë ‰ì…˜ ë° ì¸ì¦ì„œ ë°œê¸‰ìš©
server {
    listen 80;
    server_name likelion-festival.site; # ğŸ‘ˆ ë³¸ì¸ ë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½

    # Let's Encrypt ì¸ì¦ì„œ ë°œê¸‰ ì‹œ í•„ìš”í•œ ê²½ë¡œ
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    # ë‚˜ë¨¸ì§€ ëª¨ë“  ìš”ì²­ì€ HTTPSë¡œ ë¦¬ë””ë ‰ì…˜
    location / {
        return 301 https://$host$request_uri;
    }
}

# 2. HTTPS (443) ì„œë²„: ì‹¤ì œ ì„œë¹„ìŠ¤ìš©
server {
    listen 443 ssl;
    server_name likelion-festival.site; # ğŸ‘ˆ ë³¸ì¸ ë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½

    # SSL ì¸ì¦ì„œ ê²½ë¡œ ì„¤ì •
    ssl_certificate /etc/letsencrypt/live/likelion-festival.site/fullchain.pem; # ğŸ‘ˆ ë³¸ì¸ ë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½
    ssl_certificate_key /etc/letsencrypt/live/likelion-festival.site/privkey.pem; # ğŸ‘ˆ ë³¸ì¸ ë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½

    # ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•œ SSL ì„¤ì • (ê¶Œì¥)
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

    # í´ë¼ì´ì–¸íŠ¸ì˜ ì‹¤ì œ IPì™€ í”„ë¡œí† ì½œì„ ë°±ì—”ë“œë¡œ ì „ë‹¬í•˜ê¸° ìœ„í•œ í—¤ë” ì„¤ì •
    location / {
        proxy_pass http://app:8080; # Spring ì•± ì»¨í…Œì´ë„ˆë¡œ ìš”ì²­ ì „ë‹¬
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}